<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>对象作为参数传参</title>
</head>
<body>
	<script type='text/javascript'>
		// 模拟Ajax调用函数传入参数，参数为对象
		/* var obj = {
			type:'get',
			dataType:'json',
			url:'http://localhost/aaa.php',
			data:{name:'chenjing',age:56,list:[562,890]},
			success:function(){

			}
		};
		foo(obj);
		*/
		/*---------------------------------------------------------*/
		function ajax(data) {
			var type = data.type;
			var dataType = data.dataType;
			var url = data.url;
			// 形参，即对象的 data.data 赋值 data
			var data = data.data;
			var callback = data.success;
			// json类型
			if (dataType == 'json') {
				// 1.创建XHR对象
				var xhr = new XMLHttpRequest();
				// 2.发送请求前的工作
				xhr.open(type, url, true);
				// 3.执行发送动作
				var param = '';
				for (var k in data) {
					// name=chengjing&age=55&,要去掉最后一个&
					param += k + '=';
					data[k] + '&';
					// substring() 截取字符串
					param = param.substring(0, param.length - 1);
				}
				xhr.send(param);
				// 4.指定回调函数
				xhr.onreadystatechange = function () {
					if (xhr.readyState == 4) {
						if (xhr.status) {
							var result = xhr.responseText;
							callback(result);
						}
					}
				}
			}
		}
		// jsonp 类型，要跨域就需要script加路径
		else if(dataType=='jsonp'){
			/*
			jsonp本质：创建script标签，通过src属性发送一个请求，请求的返回内容是一个函数调用
			*/
			var cb = 'callback';
			var method = 'jQuery1231231231231231_2143213123';
			// 这里是回调函数
			window[method] = function(data){
				console.log(data.name);
				console.log(data.age);
			}
			var script = document.createElement('script');
			script.src = url+'?'+'cb'='method';
			// http://localhost/aaa.php?callback=jQuery1231231231231231_2143213123
			document.getElementsByTagName('head')[0].appendChild(script);
			// jQuery1231231231231231_2143213123({"name":"chenging","age":"56"})


			/*
			aaa.php获取的数据如下：
				$abc = $_GET['method'];
				//jQuery1231231231231231_2143213123

				echo $abc.'('.'{"name":"chenging","age":"56"}'.)';
				//jQuery1231231231231231_2143213123({"name":"张三","age":"12"})
			*/
		}
		ajax({
			type:'get',
			dataType:'json',
			url:'http://localhost/aaa.php',
			data:{name:'chenjing',age:56},
			success:function(result){

			}
		})
	</script>
</body>
</html>